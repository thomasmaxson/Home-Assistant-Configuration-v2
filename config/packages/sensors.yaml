################################################################################
#
# @author      : Thomas Maxson
# @package     : Custom Sensors
# @description :
#
################################################################################

sensor:
  - platform: template
    sensors:
      custom_laundry_dryer_machine_state:
        friendly_name: "Tumble Dryer Status"
        icon_template: >-
          {%- set value_on = [ 'On', 'Run' ] -%}
          {%- set value_off = [ 'Off', 'Standby', 'Finished' ] -%}
          {%- set state = states( 'sensor.laundry_dryer_machine_state' ) %}

          {%- if state in value_on -%}
            mdi:tumble-dryer
          {%- elif state in value_off -%}
            mdi:tumble-dryer
          {%- else -%}
            mdi:cloud-question
          {%- endif -%}
        value_template: >-
          {%- set value_on = [ 'On', 'Run' ] -%}
          {%- set value_off = [ 'Off', 'Standby', 'Finished' ] -%}
          {%- set state = states( 'sensor.laundry_dryer_machine_state' ) %}

          {%- if state in value_on -%}
            on
          {%- elif state in value_off -%}
            off
          {%- else -%}
            unavailable
          {%- endif -%}

      custom_laundry_washer_machine_state:
        friendly_name: "Washing Machine Status"
        icon_template: >-
          {%- set value_on = [ 'On', 'Run' ] -%}
          {%- set value_off = [ 'Off', 'Standby', 'Finished' ] -%}
          {%- set state = states( 'sensor.laundry_washer_machine_state' ) %}

          {%- if state in value_on -%}
            mdi:washing-machine
          {%- elif state in value_off -%}
            mdi:washing-machine
          {%- else -%}
            mdi:cloud-question
          {%- endif -%}
        value_template: >-
          {%- set value_on = [ 'On', 'Run' ] -%}
          {%- set value_off = [ 'Off', 'Standby', 'Finished' ] -%}
          {%- set state = states( 'sensor.laundry_washer_machine_state' ) %}

          {%- if state in value_on -%}
            on
          {%- elif state in value_off -%}
            off
          {%- else -%}
            unavailable
          {%- endif -%}

      custom_dishwasher_state:
        friendly_name: "Dishwasher Status"
        icon_template: >-
          {%- set value_on = [ 'On', 'Running' ] -%}
          {%- set value_off = [ 'Off', 'Idle', 'Complete', 'Finished' ] -%}
          {%- set state = states( 'input_select.status_dishwasher' ) %}

          {{ 'mdi:dishwasher' if state in value_on else 'mdi:dishwasher' if state in value_off else 'mdi:cloud-question' }}
        value_template: >-
          {%- set value_on = [ 'On', 'Running' ] -%}
          {%- set value_off = [ 'Off', 'Idle', 'Complete', 'Finished' ] -%}
          {%- set state = states( 'input_select.status_dishwasher' ) %}

          {{ 'on' if state in value_on else 'off' if state in value_off else 'unavailable' }}

fan:
  - platform: template
    fans:
      custom_garage_fan:
        unique_id: "custom-garage-fan-001"
        friendly_name: "Garage Fan"
        turn_on:
          action: light.turn_on
          target:
            entity_id: light.garage_fan
        turn_off:
          action: light.turn_off
          target:
            entity_id: light.garage_fan
        value_template: "{{ is_state( 'light.garage_fan', 'on' ) }}"

      custom_ceiling_bedroom_2:
        unique_id: "custom-ceiling-fan-002"
        friendly_name: "Ceiling, Bedroom 2 (Custom)"
        value_template: "{{ states( 'fan.ceiling_bedroom_2' ) }}"
        turn_on:
          - action: fan.turn_on
            target:
              entity_id: fan.ceiling_bedroom_2
        turn_off:
          - action: fan.turn_off
            target:
              entity_id: fan.ceiling_bedroom_2
        percentage_template: >
          {{ state_attr( 'fan.ceiling_bedroom_2', 'percentage' ) }}
        speed_count: 3
        set_percentage:
          - action: fan.set_percentage
            target:
              entity_id: fan.ceiling_bedroom_2
            data:
              percentage: "{{ percentage }}"
        preset_modes:
          - "off"
          - "low"
          - "medium"
          - "high"
        preset_mode_template: >
          {% if is_state( 'fan.ceiling_bedroom_2', 'on' ) %}
            {% if state_attr( 'fan.ceiling_bedroom_2', 'percentage' ) >= 100  %}
              high
            {% elif state_attr( 'fan.ceiling_bedroom_2', 'percentage' ) >= 66 %}
              medium
            {% else %}
              low
            {% endif %}
          {% else %}
            off
          {% endif %}
        set_preset_mode:
          - action: fan.set_percentage
            target:
              entity_id: fan.ceiling_bedroom_2
            data:
              percentage: >-
                {% if preset_mode == 'high' %}
                  100
                {% elif preset_mode == 'medium' %}
                  66
                {% elif preset_mode == 'low' %}
                  33
                {% else %}
                  0
                {% endif %}

      custom_ceiling_bedroom_3:
        unique_id: "custom-ceiling-fan-003"
        friendly_name: "Ceiling, Bedroom 3 (Custom)"
        value_template: "{{ states( 'fan.ceiling_bedroom_3' ) }}"
        turn_on:
          - action: fan.turn_on
            target:
              entity_id: fan.ceiling_bedroom_3
        turn_off:
          - action: fan.turn_off
            target:
              entity_id: fan.ceiling_bedroom_3
        percentage_template: >
          {{ state_attr( 'fan.ceiling_bedroom_3', 'percentage' ) }}
        speed_count: 3
        set_percentage:
          - action: fan.set_percentage
            target:
              entity_id: fan.ceiling_bedroom_3
            data:
              percentage: "{{ percentage }}"
        preset_modes:
          - "off"
          - "low"
          - "medium"
          - "high"
        preset_mode_template: >
          {% if is_state( 'fan.ceiling_bedroom_3', 'on' ) %}
            {% if state_attr( 'fan.ceiling_bedroom_3', 'percentage' ) >= 100  %}
              high
            {% elif state_attr( 'fan.ceiling_bedroom_3', 'percentage' ) >= 66 %}
              medium
            {% else %}
              low
            {% endif %}
          {% else %}
            off
          {% endif %}
        set_preset_mode:
          - action: fan.set_percentage
            target:
              entity_id: fan.ceiling_bedroom_3
            data:
              percentage: >-
                {% if preset_mode == 'high' %}
                  100
                {% elif preset_mode == 'medium' %}
                  66
                {% elif preset_mode == 'low' %}
                  33
                {% else %}
                  0
                {% endif %}

      custom_ceiling_bedroom_4:
        unique_id: "custom-ceiling-fan-004"
        friendly_name: "Ceiling, Bedroom 4 (Custom)"
        value_template: "{{ states( 'fan.ceiling_bedroom_4' ) }}"
        turn_on:
          - action: fan.turn_on
            target:
              entity_id: fan.ceiling_bedroom_4
        turn_off:
          - action: fan.turn_off
            target:
              entity_id: fan.ceiling_bedroom_4
        percentage_template: >
          {{ state_attr( 'fan.ceiling_bedroom_4', 'percentage' ) }}
        speed_count: 3
        set_percentage:
          - action: fan.set_percentage
            target:
              entity_id: fan.ceiling_bedroom_4
            data:
              percentage: "{{ percentage }}"
        preset_modes:
          - "off"
          - "low"
          - "medium"
          - "high"
        preset_mode_template: >
          {% if is_state( 'fan.ceiling_bedroom_4', 'on' ) %}
            {% if state_attr( 'fan.ceiling_bedroom_4', 'percentage' ) == 100  %}
              high
            {% elif state_attr( 'fan.ceiling_bedroom_4', 'percentage' ) == 66 %}
              medium
            {% else %}
              low
            {% endif %}
          {% else %}
            off
          {% endif %}
        set_preset_mode:
          - action: fan.set_percentage
            target:
              entity_id: fan.ceiling_bedroom_4
            data:
              percentage: >-
                {% if preset_mode == 'high' %}
                  100
                {% elif preset_mode == 'medium' %}
                  66
                {% elif preset_mode == 'low' %}
                  33
                {% else %}
                  0
                {% endif %}
